<div style="border-bottom: 4px solid black; width: 100%; box-sizing: border-box; text-align: center; padding-top: 0.1rem;" align="center">
    <h1>ä¹¦ç”Ÿå¤§æ¨¡å‹å®æˆ˜è¥ã€Œç¬¬3æœŸã€å­¦å‘˜ç¬”è®°<br/><span>åŸºç¡€å²› - æµ¦è¯­æç¤ºè¯å·¥ç¨‹å®è·µ</span></h1>
</div>
<div style="text-align: center;" align="center">
    ç¬”è®°è®°å½•äººï¼šZK-Jackie&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç¬”è®°è®°å½•æ—¶é—´ï¼š2024.7.26
</div>

## ç›®å½•

- [1 æç¤ºè¯ä¸æç¤ºè¯å·¥ç¨‹](#1-æç¤ºè¯ä¸æç¤ºè¯å·¥ç¨‹)
  - [1.1 æç¤ºè¯](#11-æç¤ºè¯)
  - [1.2 æç¤ºè¯å·¥ç¨‹](#12-æç¤ºè¯å·¥ç¨‹)
  - [1.3 LangGPT](#13-langgpt)
- [2 å®æ“ä»»åŠ¡](#2-å®æ“ä»»åŠ¡)
  - [2.1 åŸºç¡€ä»»åŠ¡](#21-åŸºç¡€ä»»åŠ¡)
    - [2.1.1 å‘ LangGPT æäº¤æç¤ºè¯è¯·æ±‚](#211-å‘-langgpt-æäº¤æç¤ºè¯è¯·æ±‚)
    - [2.1.2 å‘ internlm2-chat-1.8b æäº¤æç¤ºè¯è¯·æ±‚](#212-å‘-internlm2-chat-18b-æäº¤æç¤ºè¯è¯·æ±‚)
  - [2.2 è¿›é˜¶ä»»åŠ¡](#22-è¿›é˜¶ä»»åŠ¡)
    - [2.2.1 GSM8k ä»»åŠ¡](#221-gsm8k-ä»»åŠ¡)
    - [2.2.2 TruthfulQA ä»»åŠ¡](#222-truthfulqa-ä»»åŠ¡)
- [3 æ€»ç»“](#3-æ€»ç»“)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)
- [é™„å½•](#é™„å½•)
- [å¤‡æ³¨](#å¤‡æ³¨)

## 1 æç¤ºè¯ä¸æç¤ºè¯å·¥ç¨‹

### 1.1 æç¤ºè¯

Prompt å³æç¤ºè¯ï¼Œ**Prompt æœ€åˆæ˜¯ NLPï¼ˆè‡ªç„¶è¯­è¨€å¤„ç†ï¼‰ç ”ç©¶è€…ä¸ºä¸‹æ¸¸ä»»åŠ¡è®¾è®¡å‡ºæ¥çš„ä¸€ç§ä»»åŠ¡ä¸“å±çš„è¾“å…¥æ¨¡æ¿ï¼Œç±»ä¼¼äºä¸€ç§ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼šåˆ†ç±»ï¼Œèšç±»ç­‰ï¼‰ä¼šå¯¹åº”ä¸€ç§
Promptã€‚**

åœ¨ ChatGPT æ¨å‡ºå¹¶è·å¾—å¤§é‡åº”ç”¨ä¹‹åï¼ŒPrompt å¼€å§‹è¢«æ¨å¹¿ä¸ºç»™å¤§æ¨¡å‹çš„æ‰€æœ‰è¾“å…¥ï¼Œå³ç”¨æˆ·å‘LLMè¾“å…¥Promptï¼ŒLLMè¿”å› Completion å†…å®¹ã€‚

åœ¨ä½¿ç”¨ ChatGPT API æ—¶ï¼Œå¯ä»¥è®¾ç½®ä¸¤ç§ Promptï¼š

- System Prompt:**è¯¥ç§ Prompt å†…å®¹ä¼šåœ¨æ•´ä¸ªä¼šè¯è¿‡ç¨‹ä¸­æŒä¹…åœ°å½±å“æ¨¡å‹çš„å›å¤ï¼Œä¸”ç›¸æ¯”äºæ™®é€š Prompt å…·æœ‰æ›´é«˜çš„é‡è¦æ€§**
- User Prompt:**è¯¥ç§ Prompt ä¼šåœ¨æ¯æ¬¡å¯¹è¯ä¸­è¢«æ¨¡å‹ä½¿ç”¨ï¼Œç”¨äºæŒ‡å¯¼æ¨¡å‹ç”Ÿæˆå›å¤**

æˆ‘ä»¬ä¸€èˆ¬è®¾ç½® System Prompt æ¥å¯¹æ¨¡å‹è¿›è¡Œä¸€äº›**åˆå§‹åŒ–è®¾å®š**ã€‚åœ¨é€šè¿‡ System Prompt è®¾å®šå¥½æ¨¡å‹çš„äººè®¾æˆ–æ˜¯åˆå§‹è®¾ç½®åï¼Œæˆ‘ä»¬é€šè¿‡
User Prompt ç»™å‡ºæ¨¡å‹éœ€è¦éµå¾ªçš„æŒ‡ä»¤æˆ–æå‡ºé—®é¢˜ã€‚

éšç€å¤§æ¨¡å‹æŠ€æœ¯çš„å‘å±•ï¼ŒPrompt çš„ç±»åˆ«å’Œå½¢å¼ä¹Ÿåœ¨ä¸æ–­ä¸°å¯Œå’Œå˜åŒ–ï¼Œå¯¹äºæ”¯æŒå·¥å…·è°ƒç”¨çš„å¤§æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘å®ƒä¼ å…¥æœ‰å…³å·¥å…·çš„
Promptï¼Œè®©æ¨¡å‹å¸®åŠ©æˆ‘ä»¬å®Œæˆä¸€äº›å·¥å…·æ“ä½œï¼›å¯¹äºæ”¯æŒéŸ³é¢‘è¾“å…¥çš„å¤§æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘å®ƒä¼ å…¥éŸ³é¢‘æ–‡ä»¶çš„ Promptï¼Œè®©æ¨¡å‹å¸®åŠ©æˆ‘ä»¬å®ŒæˆéŸ³é¢‘å†…å®¹çš„è½¬å†™ã€‚

åªæœ‰æ­£ç¡®çš„ Prompt è®¾è®¡å’Œä½¿ç”¨ï¼Œæ‰èƒ½å¤§æ¨¡å‹æ›´å¥½åœ°å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ï¼ŒPrompt çš„è®¾è®¡å’Œä½¿ç”¨æˆä¸ºäº†å¤§æ¨¡å‹åº”ç”¨ä¸­çš„é‡è¦ç¯èŠ‚ã€‚

### 1.2 æç¤ºè¯å·¥ç¨‹

Prompt Engineering å³æç¤ºè¯å·¥ç¨‹ï¼Œæ˜¯æŒ‡**è®¾è®¡å’Œä½¿ç”¨ Prompt çš„è¿‡ç¨‹**ã€‚Prompt Engineering æ˜¯ä¸€ä¸ª**å¤æ‚çš„è¿‡ç¨‹**
ï¼Œéœ€è¦æˆ‘ä»¬æ ¹æ®å…·ä½“çš„ä»»åŠ¡å’Œæ¨¡å‹ç‰¹æ€§æ¥è®¾è®¡å’Œä½¿ç”¨ Promptã€‚

ä¸€èˆ¬æ¥è¯´ï¼ŒPrompt çš„è®¾è®¡éœ€è¦éµå¾ªä»¥ä¸‹å‡ ä¸ªåŸåˆ™ï¼š

- ç¼–å†™æ¸…æ™°ã€å…·ä½“çš„æŒ‡ä»¤
- æŒ‰ä¸€å®šçš„é€»è¾‘é¡ºåºç»„ç»‡ Prompt
- ä¿æŒç®€æ´ï¼Œé¿å…Promptè¿‡é•¿

Prompt Engineering è¿‡ç¨‹ä¸­ï¼Œå¤§è‡´åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

- åˆå§‹åŒ–ï¼šåœ¨å°æ ·æœ¬ä¸­è°ƒæ•´ Prompt ï¼Œå°è¯•ä½¿å…¶åœ¨è¿™äº›æ ·æœ¬ä¸Šèµ·æ•ˆã€‚
- è§£å†³ Bad Caseï¼šè¿›è¡Œè¿›ä¸€æ­¥æµ‹è¯•æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸€äº›æ£˜æ‰‹çš„ä¾‹å­ï¼Œè¿™äº›ä¾‹å­æ— æ³•é€šè¿‡ Prompt
  æˆ–è€…ç®—æ³•è§£å†³ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†è¿™äº›é¢å¤–çš„å‡ ä¸ªä¾‹å­æ·»åŠ åˆ°æ­£åœ¨æµ‹è¯•çš„é›†åˆï¼ˆå¼€å‘é›†è¿­ä»£ï¼‰ä¸­ï¼Œæœ‰æœºåœ°æ·»åŠ å…¶ä»–éš¾ä»¥å¤„ç†çš„ä¾‹å­ã€‚
- è‡ªåŠ¨è¯„ä¼°ï¼šå¼€å‘é›†ä¸æ–­æ‰©å¤§è‡³ä¸ä¾¿æµ‹è¯•çš„è§„æ¨¡æ—¶ï¼Œå¯å¼€å§‹å¼€å‘ä¸€äº›ç”¨äºè¡¡é‡è¿™äº›å°æ ·æœ¬é›†æ€§èƒ½çš„æŒ‡æ ‡ï¼Œä¾‹å¦‚å¹³å‡å‡†ç¡®åº¦ã€‚

ä¸æ–­åœ°é‡å¤è¿›è¡Œä¸Šè¿°è¿‡ç¨‹ï¼Œç›´è‡³æˆ‘ä»¬æ„å»ºå‡ºä¸€ä¸ªé«˜æ•ˆçš„ Promptï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ã€‚

æœ‰å…³äºæ›´å¤š Prompt å’Œ Prompt Engineering çš„å†…å®¹ï¼Œå¯ä»¥å‚è€ƒ[å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)ä¸­çš„ç›¸å…³é“¾æ¥ã€‚

### 1.3 LangGPT

LangGPT æ˜¯ä¸€ä¸ªå¸®åŠ©ç”¨æˆ·ç¼–å†™é«˜è´¨é‡æç¤ºè¯çš„å·¥å…·ï¼Œå¹¶å…·æœ‰ä¸€å¥—æ¨¡å—åŒ–ã€æ ‡å‡†åŒ–çš„æç¤ºè¯ç¼–å†™æ–¹æ³•è®ºâ€”â€”ç»“æ„åŒ–æç¤ºè¯ã€‚å…¶å¼€å‘å›¢é˜Ÿçš„æ„¿æ™¯æ˜¯æ¯ä¸€ä¸ªäººéƒ½èƒ½å¤Ÿå†™å‡ºé«˜è´¨é‡çš„æç¤ºè¯ï¼Œæ›´å¥½åœ°åˆ©ç”¨å¤§æ¨¡å‹çš„èƒ½åŠ›ã€‚

LangGPT å›¢é˜Ÿåˆ†åˆ«åœ¨ OpenAI å•†åº—å’Œ æœˆä¹‹æš—é¢ Kimi ä¸­å‘å¸ƒäº† LangGPT è¾…åŠ©æç¤ºè¯ç¼–å†™å·¥å…·ï¼Œæœ¬æ¬¡å®æ“ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ LangGPT
çš„å·¥å…·ï¼Œä¼˜åŒ–æç¤ºè¯ï¼Œä½¿LLMè¾“å‡ºæ­£ç¡®ç»“æœã€‚

## 2 å®æ“ä»»åŠ¡

### 2.1 åŸºç¡€ä»»åŠ¡

> - èƒŒæ™¯é—®é¢˜ï¼šè¿‘æœŸç›¸å…³ç ”ç©¶å‘ç°ï¼ŒLLMåœ¨å¯¹æ¯”æµ®ç‚¹æ•°å­—æ—¶è¡¨ç°ä¸ä½³ï¼Œç»éªŒè¯ï¼Œinternlm2-chat-1.8b (internlm2-chat-7b)ä¹Ÿå­˜åœ¨è¿™ä¸€é—®é¢˜ï¼Œä¾‹å¦‚è®¤ä¸º
    13.8<13.11ã€‚
> - ä»»åŠ¡è¦æ±‚ï¼šåˆ©ç”¨ LangGPT ä¼˜åŒ–æç¤ºè¯ï¼Œä½¿LLMè¾“å‡ºæ­£ç¡®ç»“æœã€‚
> - å®ç°æ­¥éª¤ï¼š
>     1. å‘ LangGPT æäº¤æç¤ºè¯è¯·æ±‚
>     2. å‘ internlm2-chat-1.8b æäº¤æç¤ºè¯è¯·æ±‚
>     3. ä¼˜åŒ–æç¤ºè¯ï¼Œä½¿LLMè¾“å‡ºæ­£ç¡®ç»“æœ
>     4. é‡å¤æ­¥éª¤ 1-3ï¼Œç›´è‡³LLMè¾“å‡ºæ­£ç¡®ç»“æœï¼Œè®°å½•ä¼˜åŒ–è¿‡ç¨‹å¹¶æˆªå›¾
> - ç¡¬ä»¶ç¯å¢ƒï¼š10% A100 * 1
> - è½¯ä»¶ç¯å¢ƒï¼šCuda12.2-Conda

#### 2.1.1 å‘ LangGPT æäº¤æç¤ºè¯è¯·æ±‚

æœ¬æ¬¡ä»»åŠ¡ä¸»è¦éœ€è§£å†³çš„æ˜¯å¤§è¯­è¨€æ¨¡å‹å¯¹æ¯”æµ®ç‚¹æ•°å­—æ—¶è¡¨ç°ä¸ä½³çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å‘ LangGPT æäº¤è¿™ä¸€ç±»æç¤ºè¯è¯·æ±‚ã€‚å‰å¾€ LangGPT
çš„å·¥å…·å‘å¸ƒé¡µé¢ï¼Œå‘ LangGPT æäº¤æç¤ºè¯è¯·æ±‚ï¼Œæˆ‘æäº¤çš„æç¤ºè¯å’Œè¯·æ±‚å¦‚ä¸‹ï¼š

```plaintext
ç”Ÿæˆä¸€ä¸ªèƒ½å¤Ÿç²¾å‡†æ¯”è¾ƒæµ®ç‚¹æ•°å­—çš„åŠ©æ‰‹æç¤ºè¯ã€‚
```

<div class="image-box" style="text-align: center;" align="center">
    <img class="image" style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../assets/internlm_study_v3/L1-3/1.png"
    alt="prompt-require" />
    <br/>
    <div class="caption" style="border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å›¾ 1 æäº¤æç¤ºè¯è¯·æ±‚</div>
    <br/>
</div>

å³ LangGPT åŠ©æ‰‹çš„å›ç­”å¦‚ä¸‹ï¼Œæˆ‘ä»¬ä¾¿èƒ½å¤Ÿç›´æ¥å‘ InternLM2-Chat-1.8B å‘é€è¯¥æç¤ºè¯è¯·æ±‚ã€‚

```plaintext
# Role: æµ®ç‚¹æ•°å­—æ¯”è¾ƒåŠ©æ‰‹

## Profile
- author: LangGPT 
- version: 1.0
- language: ä¸­æ–‡/è‹±æ–‡
- description: è¯¥åŠ©æ‰‹ç”¨äºç²¾ç¡®æ¯”è¾ƒæµ®ç‚¹æ•°å€¼ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨å„ç§åœºæ™¯ä¸‹è¿›è¡Œæ•°å€¼æ¯”è¾ƒæ“ä½œã€‚

## Skills
1. ç²¾ç¡®æ¯”è¾ƒä¸¤ä¸ªæµ®ç‚¹æ•°ï¼Œè€ƒè™‘åˆ°æµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ã€‚
2. æä¾›æ¥è¿‘é›¶çš„å®¹å·®èŒƒå›´ï¼Œé¿å…å› æµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜å¯¼è‡´é”™è¯¯åˆ¤æ–­ã€‚
3. æ”¯æŒä¸åŒçš„æµ®ç‚¹æ•°æ¯”è¾ƒæ–¹æ³•ï¼ŒåŒ…æ‹¬ç›´æ¥æ¯”è¾ƒã€æŒ‡å®šå®¹å·®æ¯”è¾ƒç­‰ã€‚
4. èƒ½å¤Ÿå¤„ç†ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºçš„æµ®ç‚¹æ•°ã€‚
5. å¯¹å¼‚å¸¸æƒ…å†µï¼ˆå¦‚NaNã€æ— ç©·å¤§ï¼‰è¿›è¡Œåˆç†å¤„ç†ã€‚

## Rules
1. ä½¿ç”¨ç»å¯¹å€¼å·®å€¼å°äºæŒ‡å®šå®¹å·®èŒƒå›´çš„æ–¹æ³•è¿›è¡Œæµ®ç‚¹æ•°æ¯”è¾ƒã€‚
2. é»˜è®¤å®¹å·®èŒƒå›´ä¸º1e-9ï¼Œä½†å…è®¸ç”¨æˆ·è‡ªå®šä¹‰è¯¥å€¼ã€‚
3. å½“ä¸¤ä¸ªæµ®ç‚¹æ•°çš„ç»å¯¹å€¼å·®å€¼å°äºå®¹å·®èŒƒå›´æ—¶ï¼Œåˆ¤å®šä¸¤ä¸ªæ•°ç›¸ç­‰ã€‚
4. å¯¹äºç‰¹æ®Šæµ®ç‚¹æ•°å€¼ï¼ˆå¦‚NaNã€æ­£è´Ÿæ— ç©·å¤§ï¼‰ï¼ŒæŒ‰ç…§IEEE 754æ ‡å‡†è¿›è¡Œå¤„ç†ã€‚

## Workflows
1. æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„ä¸¤ä¸ªæµ®ç‚¹æ•°å€¼å’Œï¼ˆå¯é€‰çš„ï¼‰è‡ªå®šä¹‰å®¹å·®èŒƒå›´ã€‚
2. è®¡ç®—ä¸¤ä¸ªæµ®ç‚¹æ•°çš„ç»å¯¹å€¼å·®å€¼ã€‚
3. å°†å·®å€¼ä¸å®¹å·®èŒƒå›´è¿›è¡Œæ¯”è¾ƒï¼Œåˆ¤æ–­ä¸¤ä¸ªæ•°æ˜¯å¦ç›¸ç­‰ã€‚
4. è¿”å›æ¯”è¾ƒç»“æœï¼Œå¹¶è¯´æ˜åˆ¤æ–­ä¾æ®ã€‚
5. è‹¥è¾“å…¥çš„æµ®ç‚¹æ•°åŒ…å«ç‰¹æ®Šå€¼ï¼ˆå¦‚NaNã€æ— ç©·å¤§ï¼‰ï¼Œåˆ™æŒ‰ç…§IEEE 754æ ‡å‡†è¿›è¡Œå¤„ç†å¹¶è¿”å›ç»“æœã€‚

## Init
1. æ¬¢è¿ç”¨æˆ·ä½¿ç”¨æµ®ç‚¹æ•°å­—æ¯”è¾ƒåŠ©æ‰‹ã€‚
2. è¯¢é—®ç”¨æˆ·è¾“å…¥çš„ä¸¤ä¸ªæµ®ç‚¹æ•°å€¼åŠï¼ˆå¯é€‰çš„ï¼‰è‡ªå®šä¹‰å®¹å·®èŒƒå›´ã€‚
3. æ ¹æ®ç”¨æˆ·è¾“å…¥è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶è¿”å›ç»“æœã€‚
```

#### 2.1.2 å‘ internlm2-chat-1.8b æäº¤æç¤ºè¯è¯·æ±‚

æŒ‰ç…§[ä¸Šä¸€æ¬¡ç¬”è®°](./L1-2.md)ä¸­çš„æ­¥éª¤ï¼Œåœ¨ç›¸åŒå¼€å‘ç¯å¢ƒä¸‹ä½¿ç”¨ LMDeploy éƒ¨ç½²å¸¦ WebUI çš„
InternLM2-Chat-1.8Bï¼Œå¹¶ä»¥ç”¨æˆ·èº«ä»½ç›´æ¥å‘å®ƒæäº¤æç¤ºè¯è¯·æ±‚ï¼Œå¦‚ä¸‹ `å›¾ 2` æ‰€ç¤ºï¼š

<div class="image-box" style="text-align: center;" align="center">
    <img class="image" style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../assets/internlm_study_v3/L1-3/2.png"
    alt="prompt-submit" />
    <br/>
    <div class="caption" style="border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å›¾ 2 æäº¤æç¤ºè¯è¯·æ±‚</div>
    <br/>
</div>

å¯ä»¥çœ‹åˆ°ï¼ŒInternLM2-Chat-1.8B å·²ç»æˆåŠŸæ¥æ”¶åˆ°äº†æˆ‘ä»¬çš„æç¤ºè¯è¯·æ±‚ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å‘å®ƒè¯¢é—®ä¸€äº›æµ®ç‚¹æ•°æ¯”è¾ƒé—®é¢˜ï¼Œçœ‹çœ‹å®ƒçš„å›ç­”æ˜¯å¦æ­£ç¡®ã€‚

å¤šè½®å¯¹è¯çš„è®°å½•å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| ç”¨æˆ·è¾“å…¥               | InternLM2-Chat-1.8B å›ç­”                                                                                        |
|--------------------|---------------------------------------------------------------------------------------------------------------|
| 13.8 å’Œ 13.11 å“ªä¸ªæ›´å¤§ï¼Ÿ | æ ¹æ®æµ®ç‚¹æ•°çš„ç²¾åº¦ï¼Œ13.8 å’Œ 13.11 æ˜¯ä¸¤ä¸ªéå¸¸æ¥è¿‘çš„æµ®ç‚¹æ•°ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»å¯¹å€¼å·®å€¼çº¦ä¸º 0.001ã€‚å› æ­¤ï¼Œ13.8 æ¯” 13.11 æ›´å¤§ã€‚å¦‚æœæ‚¨éœ€è¦æ›´ç²¾ç¡®çš„æ¯”è¾ƒï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨å¸Œæœ›ä½¿ç”¨å“ªç§ç²¾åº¦ï¼Œæˆ‘ä¼šå°½åŠ›æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ |
| 13.8 å’Œ 13.11 å“ªä¸ªæ›´å°ï¼Ÿ | æ ¹æ®æµ®ç‚¹æ•°çš„ç²¾åº¦ï¼Œ13.8 å’Œ 13.11 æ˜¯ä¸¤ä¸ªéå¸¸æ¥è¿‘çš„æµ®ç‚¹æ•°ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»å¯¹å€¼å·®å€¼çº¦ä¸º 0.001ã€‚å› æ­¤ï¼Œ13.11 æ¯” 13.8 æ›´å°ã€‚å¦‚æœæ‚¨éœ€è¦æ›´ç²¾ç¡®çš„æ¯”è¾ƒï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨å¸Œæœ›ä½¿ç”¨å“ªç§ç²¾åº¦ï¼Œæˆ‘ä¼šå°½åŠ›æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚ |
| 3.8 å’Œ 3.11 å“ªä¸ªå¤§ï¼Ÿ    | æ ¹æ®æµ®ç‚¹æ•°çš„ç²¾åº¦ï¼Œ3.8 å’Œ 3.11 æ˜¯ä¸¤ä¸ªéå¸¸æ¥è¿‘çš„æµ®ç‚¹æ•°ï¼Œå®ƒä»¬ä¹‹é—´çš„ç»å¯¹å€¼å·®å€¼çº¦ä¸º 0.001ã€‚å› æ­¤ï¼Œ3.8 æ¯” 3.11 æ›´å¤§ã€‚å¦‚æœæ‚¨éœ€è¦æ›´ç²¾ç¡®çš„æ¯”è¾ƒï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨å¸Œæœ›ä½¿ç”¨å“ªç§ç²¾åº¦ï¼Œæˆ‘ä¼šå°½åŠ›æ»¡è¶³æ‚¨çš„éœ€æ±‚ã€‚     |

åœ¨ä¸€å¼€å§‹æ²¡æœ‰æäº¤æç¤ºè¯çš„è¯·æ±‚æ—¶ï¼ŒInternLM2-Chat-1.8B çš„å›ç­”å†…å®¹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š

| ç”¨æˆ·è¾“å…¥               | InternLM2-Chat-1.8B å›ç­”                         |
|--------------------|------------------------------------------------|
| 13.8 å’Œ 13.11 å“ªä¸ªæ›´å¤§ï¼Ÿ | 13.8 å’Œ 13.11 éƒ½æ˜¯å°æ•°ï¼Œä½†å®ƒä»¬çš„æ•°å€¼å¤§å°ä¸åŒã€‚13.8 æ˜¯å¤§äº 13.11 çš„ã€‚ |
| 13.8 å’Œ 13.11 å“ªä¸ªæ›´å°ï¼Ÿ | 13.8 æ¯” 13.11 æ›´å°ã€‚                               |
| 3.8 å’Œ 3.11 å“ªä¸ªå¤§ï¼Ÿ    | 3.8 æ¯” 3.11 æ›´å¤§ã€‚                                 |

é€šè¿‡äºŒè€…å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæäº¤äº†æç¤ºè¯è¯·æ±‚åï¼ŒInternLM2-Chat-1.8B çš„å›ç­”æ•ˆæœæ›´åŠ å‡†ç¡®ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æ‰§è¡Œæµ®ç‚¹æ•°å€¼æ¯”è¾ƒé—®é¢˜ã€‚ç›¸å…³å›¾ç‰‡è®°å½•è§[é™„å½•-åŸºç¡€ä»»åŠ¡ææ–™](#é™„å½•)ã€‚




### 2.2 è¿›é˜¶ä»»åŠ¡

> - ä»»åŠ¡æè¿°ï¼šé€‰æ‹©ä»»åŠ¡ï¼ŒåŸºäº LangGPT æ ¼å¼ç¼–å†™ç³»ç»Ÿæç¤ºè¯ï¼Œä½¿ç”¨ OpenCompass è®© Internlm2.5-chat-7b å®Œæˆè¯¥ä»»åŠ¡ã€‚
> - å®ç°æ­¥éª¤ï¼š
>   1. å‡†å¤‡ OpenCompass è¯„æµ‹ç¯å¢ƒ
>   2. ç¼–å†™ç³»ç»Ÿæç¤ºè¯å¹¶ä½¿ç”¨ OpenCompass è¿›è¡Œè¯„æµ‹
>   3. ä¼˜åŒ–æç¤ºè¯ï¼Œä½¿ Internlm2.5-chat-7b å®Œæˆè¯¥ä»»åŠ¡
> - ç¡¬ä»¶ç¯å¢ƒï¼š30% A100 * 1

é€šè¿‡åŸºç¡€ä»»åŠ¡çš„å®è·µï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°äº† LangGPT çš„ç»“æ„åŒ–æç¤ºè¯ç¼–å†™çš„ç‰¹ç‚¹å’Œä¼˜åŠ¿ï¼Œä¸‹æ–‡æˆ‘å°†å°è¯•æŒ‰ç…§ LangGPT ç»“æ„åŒ– Prompt
çš„æ ¼å¼ç¼–å†™æç¤ºè¯ï¼Œè®© Internlm2.5-chat-7b èƒ½å¤Ÿæ›´å¥½åœ°å®Œæˆ GSM8k å’Œ TruthfulQA ä»»åŠ¡ã€‚

#### 2.2.1 GSM8k ä»»åŠ¡

æ ¹æ® OpenAI
ç ”ç©¶è€…çš„ç ”ç©¶ï¼Œå°½ç®¡éšç€å¤§æ¨¡å‹çš„ä¸æ–­å‘å±•å’Œå‚æ•°é‡çš„æ¿€å¢ï¼Œå¤§æ¨¡å‹åœ¨æ•°å­¦æ¨ç†ä»»åŠ¡ä¸Šçš„è¡¨ç°ä¹Ÿåœ¨ä¸æ–­æå‡ï¼Œä½†åœ¨å¤šæ­¥éª¤æ•°å­¦æ¨ç†é—®é¢˜ä¸Šï¼Œå¤§æ¨¡å‹çš„è¡¨ç°ä»ç„¶ä¸å°½å¦‚äººæ„ã€‚ä»–ä»¬å‘ç°å¤§æ¨¡å‹åœ¨é¢˜è§£è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶ï¼Œè‡ªå›å½’æ¨¡å‹å¹¶æ²¡æœ‰æœºåˆ¶æ¥çº æ­£è‡ªèº«é”™è¯¯ï¼Œå¯¼è‡´åç»­çš„æ¨ç†è¿‡ç¨‹ä¸­å‡ºç°çš„é”™è¯¯æ­£åé¦ˆå¼æ¿€å¢ï¼Œæœ€ç»ˆå¯¼è‡´æ¨ç†ç»“æœæ˜¯ä¸æ­£ç¡®çš„ã€‚

##### 2.2.1.1 ç¼–å†™ç¬¬ä¸€ç‰ˆæç¤ºè¯

GSM8K æ˜¯ç”±äººç±»é—®é¢˜ç¼–å†™è€…åˆ›å»ºçš„ï¼Œå« 8.5K é«˜è´¨é‡å°å­¦æ•°å­¦é—®é¢˜ï¼Œå…¶ä¸­ä¸»è¦æ˜¯å¤šæ ·åŒ–çš„å°å­¦æ•°å­¦å•è¯é—®é¢˜ï¼Œä»¥è¡¡é‡æ¨¡å‹è§£å†³å¤šæ­¥éª¤æ•°å­¦æ¨ç†é—®é¢˜çš„èƒ½åŠ›ã€‚ä»¥
**æé«˜æ¨¡å‹çš„æŒ‰æ­¥éª¤è§£é¢˜å’Œç»“æœåæ€ä¿®æ­£èƒ½åŠ›**ä¸ºç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§ LangGPT æä¾›çš„æ ¼å¼ç¼–å†™æç¤ºè¯ï¼Œå¦‚ä¸‹ï¼š

```plaintext
# Role: Grade Math Solver

## Profile
- author: LangGPT
- version: 1.0
- language: English
- description: An specialist of math solving, which aims to correctly solve multi-step math reasoning problems.

## Skills
1. Solve math problems.
2. Support multi-step math reasoning.
3. Provide step-by-step solutions.
4. Think and correct the results in the reasoning process.
5. Always to give the correct answer.

## Rules
1. Solve the math problem step by step.
2. Always check the correctness of each step.
3. Always follow the problem and conditions.
3. Correct the results in the reasoning process.

## Workflows
1. Receive the math problem.
2. Analyze the math problem and conditions.
3. Solve the math problem step by step.
4. Return the final result.
```

##### 2.2.1.2 å®‰è£… OpenCompass åŠç›®æ ‡æµ‹è¯„æ•°æ®é›†

å®Œæˆæç¤ºè¯çš„ç¼–å†™åï¼Œæ¥ä¸‹æ¥åˆ™æ˜¯ä½¿ç”¨ OpenCompass è¿›è¡Œè¯„æµ‹ï¼Œè®© Internlm2.5-chat-7b å®Œæˆ GSM8k ä»»åŠ¡ã€‚

é¦–å…ˆéœ€è¦åœ¨å½“å‰ Conda ç¯å¢ƒä¸­å®‰è£…å¥½ OpenCompassï¼Œæ¨èä» GitHub ä¸­æ‹‰å–å…¶æºç è¿›è¡Œå®‰è£…ï¼Œä»…éœ€åœ¨å¼€å‘æœºä¸­æ–­ç¯å¢ƒä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ˆå‡å®šä½ çš„å¸¸ç”¨ Conda ç¯å¢ƒåä¸º internlmï¼‰ï¼š

```bash
conda activate internlm
git clone https://github.com/open-compass/opencompass.git
cd opencompass
pip install -e .
```

éšåï¼Œæˆ‘ä»¬éœ€è¦ä» GitHub ä¸­æ‹‰å– OpenAI å¼€æºçš„ GSM8k æ•°æ®é›†ï¼Œä»¥ä¾¿è¿›è¡Œè¯„æµ‹ã€‚æ•°æ®é›† jsonl æ–‡ä»¶å…·ä½“è·¯å¾„å¯è‡ªé€‰ï¼Œä½†å¿…é¡»åœ¨è¿è¡Œ OpenCompass æ—¶çš„ç»ˆç«¯è·¯å¾„ä¸‹çš„ data/gsm8k ç›®å½•ä¸‹ï¼Œä»¥ä¾¿ OpenCompass èƒ½å¤Ÿæ­£ç¡®è¯»å–æ•°æ®é›†ã€‚æ­¤å¤„æˆ‘é€‰æ‹©å®‰è£…åœ¨ opencompass çš„æºç ç›®å½•ä¸‹ï¼Œåç»­ä¹Ÿå°†åœ¨è¯¥ç›®å½•ä¸‹è¿è¡Œä»£ç ã€‚è¾“å…¥ä»¥ä¸‹å‘½ä»¤æ‹‰å– GSM8k æ•°æ®é›†å¹¶æ”¾å…¥æŒ‡å®šæ–‡ä»¶å¤¹ä¸­ï¼š

```bash
cd /root/opencompass/
mkdir -p data/gsm8k
git clone https://github.com/openai/grade-school-math.git
cp grade-school-math/grade-school-math/data/train.jsonl data/gsm8k/
cp grade-school-math/grade-school-math/data/test.jsonl data/gsm8k/
```

##### 2.2.1.3 é…ç½®è¯„æµ‹ä»»åŠ¡

æ ¹æ®è¦æ±‚ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šèŠå¤©å¯¹è¯çš„ç³»ç»Ÿæç¤ºè¯ä¸ºæˆ‘ä»¬åˆšç¼–å†™å¥½çš„æç¤ºè¯ï¼Œåˆ™éœ€è¦ä¿®æ”¹æ•°æ®è®°å¾—èŠå¤©æ¨¡æ¿é…ç½®ã€‚åœ¨é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œ[å­¦ä¹  OpenCompass çš„é…ç½®æ–¹æ³•](https://opencompass.readthedocs.io/zh-cn/latest/user_guides/config.html)åï¼Œå†ç»“åˆ [OpenCompass æºç ç›®å½•ä¸‹çš„è¯„æµ‹å¯åŠ¨é…ç½®æ–‡ä»¶](https://github.com/open-compass/opencompass/blob/main/configs/eval_chat_demo.py)ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¾ç…§ OpenCompass æ•°æ®é›†æµ‹è¯•é…ç½®æ–‡ä»¶ `opencompass/configs/datasets/gsm8k/gsm8k_gen_1d7fe4.py` æ¥è‡ªå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„æµ‹è¯•é…ç½®æ–‡ä»¶ã€‚æ­¤å¤„æˆ‘é€‰æ‹©ç›´æ¥ä¿®æ”¹æºç ï¼Œå¹¶ä¸»è¦ä¿®æ”¹å…¶ä¸­çš„ `prompt_template` éƒ¨åˆ†å’Œ `gsm8k_datasets` éƒ¨åˆ†ï¼Œæ·»åŠ ä¸Šæˆ‘ä»¬ç¼–å†™çš„ System Prompt æ–‡æœ¬ï¼Œä¿®æ”¹æˆ‘ä»¬ä¸‹è½½çš„æ•°æ®é›†çš„å®é™…è·¯å¾„ã€‚åœ¨æˆ‘çš„ç¯å¢ƒä¸­ä¿®æ”¹å®Œæˆåï¼Œæ•´ä¸ªæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š

```python
# opencompass/opencompass/configs/datasets/gsm8k/gsm8k_gen_1d7fe4.py
from opencompass.openicl.icl_prompt_template import PromptTemplate
from opencompass.openicl.icl_retriever import ZeroRetriever
from opencompass.openicl.icl_inferencer import GenInferencer
from opencompass.datasets import GSM8KDataset, gsm8k_postprocess, gsm8k_dataset_postprocess, Gsm8kEvaluator

gsm8k_reader_cfg = dict(input_columns=['question'], output_column='answer')

gsm8k_infer_cfg = dict(
    prompt_template=dict(
        type=PromptTemplate,
        template=dict(
            begin=[
                dict(role='SYSTEM', fallback_role='HUMAN', prompt='# Role: Grade Math Solver\n\n## Profile\n- author: LangGPT\n- version: 1.0\n- language: English\n- description: An specialist of math solving, which aims to correctly solve multi-step math reasoning problems.\n\n## Skills\n1. Solve math problems.\n2. Support multi-step math reasoning.\n3. Provide step-by-step solutions.\n4. Think and correct the results in the reasoning process.\n5. Always to give the correct answer.\n\n## Rules\n1. Solve the math problem step by step.\n2. Always check the correctness of each step.\n3. Always follow the problem and conditions.\n3. Correct the results in the reasoning process.\n\n## Workflows\n1. Receive the math problem.\n2. Analyze the math problem and conditions.\n3. Solve the math problem step by step.\n4. Return the final result.'),
            ],
            round=[
                dict(role='HUMAN', prompt="Question: Angelo and Melanie want to plan how many hours over the next week they should study together for their test next week. They have 2 chapters of their textbook to study and 4 worksheets to memorize. They figure out that they should dedicate 3 hours to each chapter of their textbook and 1.5 hours for each worksheet. If they plan to study no more than 4 hours each day, how many days should they plan to study total over the next week if they take a 10-minute break every hour, include 3 10-minute snack breaks each day, and 30 minutes for lunch each day?\nLet's think step by step\nAnswer:"),
                dict(role='BOT', prompt='Angelo and Melanie think they should dedicate 3 hours to each of the 2 chapters, 3 hours x 2 chapters = 6 hours total.\nFor the worksheets they plan to dedicate 1.5 hours for each worksheet, 1.5 hours x 4 worksheets = 6 hours total.\nAngelo and Melanie need to start with planning 12 hours to study, at 4 hours a day, 12 / 4 = 3 days.\nHowever, they need to include time for breaks and lunch. Every hour they want to include a 10-minute break, so 12 total hours x 10 minutes = 120 extra minutes for breaks.\nThey also want to include 3 10-minute snack breaks, 3 x 10 minutes = 30 minutes.\nAnd they want to include 30 minutes for lunch each day, so 120 minutes for breaks + 30 minutes for snack breaks + 30 minutes for lunch = 180 minutes, or 180 / 60 minutes per hour = 3 extra hours.\nSo Angelo and Melanie want to plan 12 hours to study + 3 hours of breaks = 15 hours total.\nThey want to study no more than 4 hours each day, 15 hours / 4 hours each day = 3.75\nThey will need to plan to study 4 days to allow for all the time they need.\nThe answer is 4\n'),
                dict(role='HUMAN', prompt="Question: Mark's basketball team scores 25 2 pointers, 8 3 pointers and 10 free throws.  Their opponents score double the 2 pointers but half the 3 pointers and free throws.  What's the total number of points scored by both teams added together?\nLet's think step by step\nAnswer:"),
                dict(role='BOT', prompt="Mark's team scores 25 2 pointers, meaning they scored 25*2= 50 points in 2 pointers.\nHis team also scores 6 3 pointers, meaning they scored 8*3= 24 points in 3 pointers\nThey scored 10 free throws, and free throws count as one point so they scored 10*1=10 points in free throws.\nAll together his team scored 50+24+10= 84 points\nMark's opponents scored double his team's number of 2 pointers, meaning they scored 50*2=100 points in 2 pointers.\nHis opponents scored half his team's number of 3 pointers, meaning they scored 24/2= 12 points in 3 pointers.\nThey also scored half Mark's team's points in free throws, meaning they scored 10/2=5 points in free throws.\nAll together Mark's opponents scored 100+12+5=117 points\nThe total score for the game is both team's scores added together, so it is 84+117=201 points\nThe answer is 201\n"),
                dict(role='HUMAN', prompt="Question: Bella has two times as many marbles as frisbees. She also has 20 more frisbees than deck cards. If she buys 2/5 times more of each item, what would be the total number of the items she will have if she currently has 60 marbles?\nLet's think step by step\nAnswer:"),
                dict(role='BOT', prompt="When Bella buys 2/5 times more marbles, she'll have increased the number of marbles by 2/5*60 = 24\nThe total number of marbles she'll have is 60+24 = 84\nIf Bella currently has 60 marbles, and she has two times as many marbles as frisbees, she has 60/2 = 30 frisbees.\nIf Bella buys 2/5 times more frisbees, she'll have 2/5*30 = 12 more frisbees.\nThe total number of frisbees she'll have will increase to 30+12 = 42\nBella also has 20 more frisbees than deck cards, meaning she has 30-20 = 10 deck cards\nIf she buys 2/5 times more deck cards, she'll have 2/5*10 = 4 more deck cards.\nThe total number of deck cards she'll have is 10+4 = 14\nTogether, Bella will have a total of 14+42+84 = 140 items\nThe answer is 140\n"),
                dict(role='HUMAN', prompt="Question: A group of 4 fruit baskets contains 9 apples, 15 oranges, and 14 bananas in the first three baskets and 2 less of each fruit in the fourth basket. How many fruits are there?\nLet's think step by step\nAnswer:"),
                dict(role='BOT', prompt='For the first three baskets, the number of apples and oranges in one basket is 9+15=24\nIn total, together with bananas, the number of fruits in one basket is 24+14=38 for the first three baskets.\nSince there are three baskets each having 38 fruits, there are 3*38=114 fruits in the first three baskets.\nThe number of apples in the fourth basket is 9-2=7\nThere are also 15-2=13 oranges in the fourth basket\nThe combined number of oranges and apples in the fourth basket is 13+7=20\nThe fourth basket also contains 14-2=12 bananas.\nIn total, the fourth basket has 20+12=32 fruits.\nThe four baskets together have 32+114=146 fruits.\nThe answer is 146\n'),
                dict(role='HUMAN', prompt="Question: {question}\nLet's think step by step\nAnswer:"),
            ],
        )),
    retriever=dict(type=ZeroRetriever),
    inferencer=dict(type=GenInferencer, max_out_len=512))

gsm8k_eval_cfg = dict(evaluator=dict(type=Gsm8kEvaluator),
                      pred_postprocessor=dict(type=gsm8k_postprocess),
                      dataset_postprocessor=dict(type=gsm8k_dataset_postprocess))

gsm8k_datasets = [
    dict(
        abbr='gsm8k',
        type=GSM8KDataset,
        path='./data/gsm8k',
        reader_cfg=gsm8k_reader_cfg,
        infer_cfg=gsm8k_infer_cfg,
        eval_cfg=gsm8k_eval_cfg)
]
```

è‹¥æƒ³æ ¡éªŒä¿®æ”¹ç»“æœï¼Œè¿˜å¯ä½¿ç”¨ OpenCompass æä¾›çš„ python å·¥å…· `prompt_viewer` è¿›è¡Œæµ‹è¯•ï¼Œåªéœ€åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š

```bash
python tools/prompt_viewer.py configs/datasets/gsm8k/gsm8k_gen_1d7fe4.py -n -a -p gsm8k
```

python tools/prompt_viewer.py /root/opencompass/configs/datasets/truthfulqa/truthfulqa_gen_1e7d8d.py -n -a -p truthful_qa

å…¶ä¸­ï¼Œ`tools/prompt_viewer.py` æ˜¯ OpenCompass æä¾›çš„ python å·¥å…·ï¼Œéœ€è‡ªè¡Œæ ¹æ®æƒ…å†µå®šä½åˆ° OpenCompass å¯¹åº”ç›®å½•ä¸­ï¼Œ`opencompass/configs/datasets/gsm8k/gsm8k_gen_1d7fe4.py` æ˜¯é…ç½®æ–‡ä»¶è·¯å¾„ï¼›å…¶ä»–é€‰é¡¹å…·ä½“å«ä¹‰è§[ OpenCompass å¯¹ prompt_viewer çš„ä»‹ç»](https://opencompass.readthedocs.io/zh-cn/latest/tools.html)ã€‚

é…ç½®æ–‡ä»¶æµ‹è¯•ç»“æœå¦‚ä¸‹ `å›¾ 3` æ‰€ç¤ºï¼Œè¯´æ˜é…ç½®æ–‡ä»¶çš„ä¿®æ”¹æ˜¯æœ‰æ•ˆçš„ï¼Œåˆ™å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥çš„è¯„æµ‹ã€‚

<div class="image-box" style="text-align: center;" align="center">
    <img class="image" style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../assets/internlm_study_v3/L1-3/3.png"
    alt="prompt-viewer-tool" />
    <br/>
    <div class="caption" style="border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å›¾ 3 OpenCompass é…ç½®æ–‡ä»¶æµ‹è¯•ç»“æœ</div>
    <br/>
</div>

##### 2.2.1.4 å¼€å§‹è¯„æµ‹

åœ¨é…ç½®æ–‡ä»¶ä¿®æ”¹ã€æ ¡éªŒå®Œæˆåï¼Œå³å¯å¼€å§‹ä½¿ç”¨ OpenCompassã€ä½¿ç”¨ä¿®æ”¹è¿‡åçš„é…ç½®æ–‡ä»¶ã€ä½¿ç”¨æœ¬åœ°æ¨¡å‹è¿›è¡Œè¯„æµ‹ï¼Œåªéœ€åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š

```bash
python3 run.py --datasets gsm8k_gen_1d7fe4 \
--hf-path /root/share/new_models/Shanghai_AI_Laboratory/internlm2_5-7b-chat \
--tokenizer-path /root/share/new_models/Shanghai_AI_Laboratory/internlm2_5-7b-chat \
--tokenizer-kwargs padding_side='left' truncation='left' trust_remote_code=True \
--model-kwargs trust_remote_code=True device_map='auto' \
--max-seq-len 2048 \
--max-out-len 128 \
--batch-size 2 \
--hf-num-gpus 1 \
--debug
```

ç­‰å¾… OpenCompass å¤„ç†æŒ‡ä»¤ä¸€æ®µæ—¶é—´ï¼Œå¼€å§‹æ¨ç†æ¨¡å‹ï¼Œä¾¿èƒ½å¤Ÿè¿›å…¥è¯„æµ‹ç¯èŠ‚ï¼Œå…¶è¿›åº¦å¯åœ¨æ§åˆ¶å°ä¸­æ˜¾ç¤ºï¼Œå¦‚ä¸‹`å›¾ 4` æ‰€ç¤ºã€‚

<div class="image-box" style="text-align: center;" align="center">
    <img class="image" style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../assets/internlm_study_v3/L1-3/4.png"
    alt="opencompass-evaluation" />
    <br/>
    <div class="caption" style="border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å›¾ 4 OpenCompass è¯„æµ‹</div>
    <br/>
</div>

æ­¤æ—¶å¯å…³é—­ç½‘é¡µç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè¿›è¡Œå…¶ä»–å·¥ä½œã€‚

##### 2.2.1.5 ç¬¬ä¸€æ¬¡è¯„æµ‹

ç­‰å¾…ä¸‰å°æ—¶å·¦å³ï¼Œå¯å¾—åˆ°ç¬¬ä¸€æ¬¡è¯„æµ‹çš„ç»“æœå¦‚ä¸‹ `å›¾ 5` ï¼Œè¯¦ç»†çš„æ£€æµ‹ç»“æœæŠ¥å‘Šå¯è§[é™„å½•-è¿›é˜¶ä»»åŠ¡ææ–™](#é™„å½•)ï¼š

<div class="image-box" style="text-align: center;" align="center">
    <img class="image" style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../assets/internlm_study_v3/L1-3/5.png"
    alt="first-evaluation-result" />
    <br/>
    <div class="caption" style="border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å›¾ 5 ç¬¬ä¸€æ¬¡è¯„æµ‹ç»“æœ</div>
    <br/>
</div>

æ ¹æ®è¯„æµ‹ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº†æˆ‘ä»¬ç¼–å†™çš„ System Prompt åï¼ŒInternLM2.5-Chat-7B åœ¨ GSM8k ä»»åŠ¡ä¸Šçš„å¾—åˆ†ä¸º 84.69 åˆ†ï¼Œç›¸è¾ƒäºæœªä½¿ç”¨å¼•å¯¼æ€§å¼ºçš„ Promptï¼Œ

##### 2.2.1.6 ç¬¬äºŒæ¬¡ä¼˜åŒ–æç¤ºè¯åŠè¯„æµ‹

é€šè¿‡å¯¹ç¬¬ä¸€ç‰ˆæç¤ºè¯çš„åˆ†æï¼Œå¯ä»¥æ³¨æ„åˆ°ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š

- æœ‰è¿‡å¤šæ²¡å¿…è¦çš„æè¿°ï¼Œå¯¼è‡´æç¤ºè¯è¿‡é•¿ï¼Œä¸åˆ©äºæ¨¡å‹ç†è§£ã€‚
- æç¤ºè¯ä¸­çš„è§„åˆ™å’Œæµç¨‹æè¿°è¿‡äºç¹çï¼Œä¸åˆ©äºæ¨¡å‹ç†è§£å’Œæ‰§è¡Œã€‚
- è¯„æµ‹å‚æ•°ä¸­çš„è¾“å…¥è¾“å‡ºè®¾ç½®å¯èƒ½ä¸åˆç†ï¼Œå¯¼è‡´æ¨¡å‹æ— æ³•æ­£ç¡®ç†è§£é¢˜æ„æˆ–å›ç­”åˆ°å…³é”®ç‚¹ã€‚

æˆ‘è®¤ä¸ºï¼ŒInternLM2.5-Chat-7B åœ¨å¤„ç†å°å­¦é—®é¢˜ä¸Šè¿˜æœ‰å¾ˆå¤§æ½œåŠ›ï¼Œä»–ä¸€å®šèƒ½åœ¨ GSM8k ä»»åŠ¡ä¸Šçš„è¡¨ç°å¾—æ›´å¥½ï¼æ‰€ä»¥åœ¨å¯¹é—®é¢˜æ·±å…¥çš„æ€è€ƒå’Œè§£å†³åï¼Œæˆ‘ç¼–å†™äº†ç¬¬äºŒç‰ˆæç¤ºè¯ï¼Œå¦‚ä¸‹ï¼š

```plaintext
# Role: Grade Math Solver

## Profile
- author: InternLM
- language: English
- description: An specialist of math solving, which aims to correctly solve multi-step math reasoning problems.

## Skills
1. Solve math problems.
2. Support multi-step math reasoning.
3. Solve the problem step-by-step.
4. Think and correct the results in the reasoning process.
5. Always to give the correct answer.

## Rules
1. Solve the math problem step by step.
2. Always check the correctness of each step.
3. Always follow the problem and conditions.
3. Correct the results in the reasoning process.

## Workflows
1. Receive the math problem.
2. Analyze the math problem and conditions.
3. Think about the way to solve the problem.
4. Solve the math problem step by step.
5. Output the key steps and the final result.
```

å¯¹åº”çš„ä¿®æ”¹è¿‡åçš„è¯„æµ‹å¯åŠ¨å‚æ•°é¼“åŠ±æ¨¡å‹æ›´å¥½ç†è§£æç¤ºè¯ã€å……åˆ†æ€è€ƒå¹¶åšå‡ºå›ç­”ï¼Œå¦‚ä¸‹ï¼š

```bash
python3 run.py --datasets gsm8k_gen_1d7fe4 \
--hf-path /root/share/new_models/Shanghai_AI_Laboratory/internlm2_5-7b-chat \
--tokenizer-path /root/share/new_models/Shanghai_AI_Laboratory/internlm2_5-7b-chat \
--tokenizer-kwargs padding_side='left' truncation='left' trust_remote_code=True \
--model-kwargs trust_remote_code=True device_map='auto' \
--max-seq-len 2048 \
--max-out-len 512 \
--batch-size 2 \
--hf-num-gpus 1 \
--debug
```

ä¾ç…§å‰æ–‡æ‰€è¿°çš„æµç¨‹å†æ¬¡ä¿®æ”¹é…ç½®æ–‡ä»¶å¹¶å¯åŠ¨è¯„æµ‹ï¼Œç­‰å¾…å¾ˆé•¿çš„ä¸€æ®µæ—¶é—´ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ç¬¬äºŒæ¬¡è¯„æµ‹çš„ç»“æœå¦‚ä¸‹ `å›¾ 6` ï¼š

<div class="image-box" style="text-align: center;" align="center">
    <img class="image" style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../assets/internlm_study_v3/L1-3/7.png"
    alt="second-evaluation-result" />
    <br/>
    <div class="caption" style="border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å›¾ 6 ç¬¬äºŒæ¬¡è¯„æµ‹ç»“æœ</div>
    <br/>
</div>

ç¬¬äºŒæ¬¡çš„æµ‹è¯„ç»“æœæ˜¾ç¤ºï¼ŒInternLM2.5-Chat-7B åœ¨ GSM8k ä»»åŠ¡ä¸Šçš„å¾—åˆ†ä¸º 84.38 åˆ†ï¼Œç›¸è¾ƒäºç¬¬ä¸€æ¬¡è¯„æµ‹å‡ ä¹æ²¡æœ‰å˜åŒ–ï¼Œç”šè‡³ç•¥æœ‰ä¸‹é™ã€‚è¿™è¯´æ˜ç¬¬äºŒç‰ˆæç¤ºè¯çš„æ•ˆæœå¹¶ä¸å¦‚é¢„æœŸï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚ğŸ˜‚

è¯¦ç»†çš„è¯„æµ‹ç»“æœæŠ¥å‘Šå¯è§[é™„å½•-è¿›é˜¶ä»»åŠ¡ææ–™](#é™„å½•)ã€‚


#### 2.2.2 TruthfulQA ä»»åŠ¡

é™¤ GSM8k ä»»åŠ¡å¤–ï¼Œæˆ‘ä¹Ÿå°è¯•ä¼˜åŒ– InternLM2.5-Chat-7B åœ¨ TruthfulQA ä»»åŠ¡ä¸Šçš„è¡¨ç°ã€‚

TruthfulQA æ˜¯ä¸€é¡¹ç”¨äºè¡¡é‡æ¨¡å‹å¤åˆ¶ç½‘ä¸Šå¸¸è§è™šå‡ä¿¡æ¯å€¾å‘çš„æµ‹è¯•ã€‚åœ¨è¿™é¡¹æµ‹è¯•ä¸­ï¼Œç ”ç©¶è€…å‘ç°ï¼Œå¤§å‹è¯­è¨€æ¨¡å‹åœ¨å›ç­”å…³äºè™šå‡ä¿¡æ¯çš„é—®é¢˜æ—¶ï¼Œå¾€å¾€ä¼šå¤åˆ¶ç½‘ä¸Šå¸¸è§çš„è™šå‡ä¿¡æ¯ï¼Œè€Œä¸æ˜¯æä¾›æ­£ç¡®çš„ç­”æ¡ˆã€‚

è¿™ä¸ªé—®é¢˜çš„æ ¹æºåœ¨äºï¼Œå¤§å‹è¯­è¨€æ¨¡å‹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šå­¦ä¹ åˆ°å¤§é‡çš„æ–‡æœ¬æ•°æ®ï¼Œå…¶ä¸­åŒ…å«äº†å¤§é‡çš„è™šå‡ä¿¡æ¯ï¼Œè€Œå¤§è¯­è¨€æ¨¡å‹åœ¨ç”Ÿæˆç­”æ¡ˆæ—¶ï¼Œä¼šä¼˜å…ˆè€ƒè™‘åˆ°è®­ç»ƒæ•°æ®ä¸­çš„ä¿¡æ¯ï¼Œè€Œæ²¡æœ‰äºŒæ¬¡è€ƒé‡å›ç­”çš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ã€‚

å› æ­¤ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå…³é”®åœ¨äºå¤§è¯­è¨€æ¨¡å‹è¦èƒ½å¤Ÿ**è¯†åˆ«å’Œçº æ­£è™šå‡ä¿¡æ¯ï¼Œåœ¨æ¯ä¸€æ¬¡å›ç­”é—®é¢˜æ—¶ï¼Œéƒ½è¦è€ƒè™‘åˆ°å›ç­”çš„æ­£ç¡®æ€§**ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ç…§
LangGPT æä¾›çš„æ ¼å¼ç¼–å†™æç¤ºè¯ï¼Œå¦‚ä¸‹ï¼š

```plaintext
# Role: Truth Answerer

## Profile
- author: InternLM
- language: English
- description: An expert in checking the truth of the information, which aims to provide correct answers, avoid copying false information and tell the judgement of the answers.

## Skills
1. Verify the authenticity of the information
2. Provide correct answers.
3. Reflect on the answers and correct the wrong answers.

## Rules
1. Avoid using false information.
2. Analyze the question and the information before answering.
3. Only provide the correct answer.
4. Only output 'yes' or 'no'.
5. When the answer is uncertain, output 'no'.

## Workflows
1. Receive the infomation.
2. Check the truth of the information.
3. Think whether the information is correct or not.
4. Check your answer and correct it if it is wrong.
5. Output the final result.
```

ç»è¿‡æµ‹è¯•ï¼ŒTruthfulQA æ•°æ®é›†çš„è¯„æµ‹åªèƒ½é€šè¿‡ API è¿›è¡Œï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ© LMDeploy å…ˆè¡Œå°† InternLM2.5-Chat-7B çš„ API æœåŠ¡éƒ¨ç½²åœ¨å¼€å‘æœºä¸Šï¼Œå†ä½¿ç”¨ OpenCompass è¿›è¡Œè¯„æµ‹ã€‚

æ²¿ç”¨åŸºç¡€ä»»åŠ¡ä¸­æ‰€ä½¿ç”¨çš„ç¯å¢ƒï¼Œç›´æ¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¯åŠ¨ LMDeploy æœåŠ¡ï¼š

```bash
lmdeploy serve api_server /root/share/new_models/Shanghai_AI_Laboratory/internlm2_5-7b-chat --port 8000
```

éšåä¾ç…§ [OpenCompass çš„å®˜æ–¹æ–‡æ¡£](https://opencompass.org.cn/doc)å’ŒOpenCompass é…ç½®æ–‡ä»¶ä¸­æœ‰å…³[å‡†å¤‡æ¨¡å‹](https://opencompass.readthedocs.io/zh-cn/latest/user_guides/models.html)çš„ç¼–å†™æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€ä¸ªè°ƒç”¨ InternLM2.5-Chat-7B API æœåŠ¡çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š

```python
# ~/opencompass/custom_configs/eval_truthfulqa_api.py
from mmengine.config import read_base
from opencompass.models.turbomind import TurboMindModel

with read_base():
    # choose a list of datasets
    from .datasets.truthfulqa.truthfulqa_gen_5ddc62 import truthfulqa_datasets
    # and output the results in a choosen format
    from .summarizers.medium import summarizer

# sum the datasets
datasets = sum((v for k, v in locals().items() if k.endswith('_datasets')), [])

# config for internlm-chat-1_8b
internlm2_5_chat_7b = dict(
    type=TurboMindModel,
    abbr='internlm2_5-chat-7b-turbomind-api',
    api_addr='http://0.0.0.0:8000',
    max_out_len=32,
    max_seq_len=2048,
    batch_size=4,
    run_cfg=dict(num_gpus=1, num_procs=1),
)

models = [internlm2_5_chat_7b]
```

éšåç›´æ¥å€ŸåŠ© OpenCompass æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ ¹æ®æˆ‘ä»¬è®¾å®šçš„é…ç½®ï¼Œå¯åŠ¨è¯„æµ‹ä»»åŠ¡ï¼Œå¦‚ä¸‹ï¼š

```bash
cd /root/opencompass
python3 run.py --models custom_configs/eval_truthfulqa_api.py --debug
```

ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ° TruthfulQA ä»»åŠ¡çš„è¯„æµ‹ç»“æœï¼Œå¦‚ä¸‹ `å›¾ 7` ï¼š

<div class="image-box" style="text-align: center;" align="center">
    <img class="image" style="border-radius: 0.3125em;
    box-shadow: 0 2px 4px 0 rgba(34,36,38,.12),0 2px 10px 0 rgba(34,36,38,.08);" 
    src="../assets/internlm_study_v3/L1-3/8.png"
    alt="truthfulqa-evaluation-result" />
    <br/>
    <div class="caption" style="border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">å›¾ 7 TruthfulQA ä»»åŠ¡è¯„æµ‹ç»“æœ</div>
    <br/>
</div>

æ ¹æ®è¯„æµ‹ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº†æˆ‘ä»¬ç¼–å†™çš„ System Prompt åï¼ŒInternLM2.5-Chat-7B åœ¨ TruthfulQA ä»»åŠ¡ä¸Šçš„å¾—åˆ†ä¸º 84.69 åˆ†ï¼Œç›¸è¾ƒäºå®˜æ–¹ç»™å‡ºçš„ baselineï¼Œå³æœªä½¿ç”¨å¼•å¯¼æ€§å¼ºçš„ Prompt æ—¶çš„å¾—åˆ†ï¼Œæœ‰æ‰€æå‡ã€‚

è¯¦ç»†çš„è¯„æµ‹ç»“æœæŠ¥å‘Šå¯è§[é™„å½•-è¿›é˜¶ä»»åŠ¡ææ–™](#é™„å½•)ã€‚

## 3 æ€»ç»“

æœ¬æ¬¡å®æ“ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ LangGPT å®Œæˆäº†æç¤ºè¯çš„ç¼–å†™ï¼Œä½¿å¾— InternLM2-Chat-1.8B èƒ½å¤Ÿæ›´å¥½åœ°å®Œæˆæµ®ç‚¹æ•°å€¼æ¯”è¾ƒé—®é¢˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨ LangGPT æä¾›çš„ç»“æ„åŒ–æç¤ºè¯ç¼–å†™æ–¹æ³•ï¼Œä¼˜åŒ–æç¤ºè¯ï¼Œä½¿ Internlm2.5-chat-7b èƒ½å¤Ÿæ›´å¥½åœ°å®Œæˆ GSM8k å’Œ TruthfulQA ä»»åŠ¡ã€‚

é€šè¿‡æœ¬æ¬¡å®æ“ä»»åŠ¡ï¼Œæˆ‘ä»¬æ›´åŠ æ·±å…¥åœ°äº†è§£äº†æç¤ºè¯çš„è®¾è®¡å’Œä½¿ç”¨ï¼Œä»¥åŠæç¤ºè¯å·¥ç¨‹çš„é‡è¦æ€§ï¼Œä¸ºåç»­æ›´å¤šæ›´æœ‰æ„ä¹‰ã€æ›´åŠ é«˜æ·±çš„å®æ“ä»»åŠ¡åšå¥½äº†å‡†å¤‡ã€‚

## å‚è€ƒèµ„æ–™

- [Prompt Engineering - åŠ¨æ‰‹å­¦å¤§æ¨¡å‹åº”ç”¨å¼€å‘ - Datawhale](https://datawhalechina.github.io/llm-universe/#/C2/3.%20Prompt%20Engineering)
- [LangGPT - GitHub](https://github.com/langgptai/LangGPT)
- [ChatGPT - LangGPT æç¤ºè¯ä¸“å®¶](https://chatgpt.com/g/g-Apzuylaqk-langgpt-ti-shi-ci-zhuan-jia)
- [Training Verifiers to Solve Math Word Problems - arxiv - OpenAI](https://arxiv.org/pdf/2110.14168)
- [GSM8K - GitHub](https://github.com/openai/grade-school-math)
- [TruthfulQA: Measuring How Models Mimic Human Falsehoods - OpenAI](https://arxiv.org/abs/2109.07958)
- [TruthfulQA - GitHub](https://github.com/sylinrl/TruthfulQA)
- [LMDeploy - GitHub](https://github.com/internlm/lmdeploy/)
- [LMDeploy - å®˜æ–¹æ–‡æ¡£](https://lmdeploy.readthedocs.io/zh-cn/latest)
- [OpenCompass - GitHub](https://github.com/open-compass/OpenCompass/)
- [OpenCompass - å®˜æ–¹æ–‡æ¡£](https://opencompass.readthedocs.io/zh-cn/latest/)

## é™„å½•

- [åŸºç¡€ä»»åŠ¡ææ–™](../../res/internlm_study_v3/L1-3/basic)
- [è¿›é˜¶ä»»åŠ¡ææ–™](../../res/internlm_study_v3/L1-3/advanced)

<table>
  <tr>
    <td colspan="3" align="center">è¯„æµ‹å¾—åˆ†å¯¹æ¯”</td>
  </tr>
  <tr>
    <th>ä»»åŠ¡åç§°</th>
    <th>baseline</th>
    <th>è‡ªå®šä¹‰æç¤ºè¯å¾—åˆ†</th>
  </tr>
  <tr>
    <td rowspan="2">GSM8k</td>
    <td rowspan="2">??.??</td>
    <td>84.69(ç¬¬ä¸€ç»„)</td>
  </tr>
  <tr>
    <td>84.38(ç¬¬äºŒç»„)</td>
  </tr>
  <tr>
    <td>TruthfulQA</td>
    <td>??.??</td>
    <td>??.??</td>
  </tr>
</table>


## å¤‡æ³¨

ç”±äºæœ¬æ¬¡å®æ“ä»»åŠ¡å¼€å§‹åŠå®Œæˆè¾ƒæ—©ï¼Œéƒ¨åˆ†å†…å®¹å¯èƒ½ä¸æœ€æ–°çš„å®æ“ä»»åŠ¡è¦æ±‚å’Œæ‰§è¡Œæ­¥éª¤æœ‰æ‰€å‡ºå…¥ï¼Œä»…ä¾›å‚è€ƒã€‚
